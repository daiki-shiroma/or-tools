# 人員最適配置ソルバー with Google OR-Tools

このプロジェクトは、Googleのオープンソースライブラリ「OR-Tools」を使用して、従業員をプロジェクトに最適に割り当てる問題を解決するデモです。

## Google OR-Toolsとは？

[Google OR-Tools](https://developers.google.com/optimization)は、組み合わせ最適化問題を解決するためのオープンソースソフトウェアスイートです。車両ルーティング、スケジューリング、ビンパッキングなど、さまざまな問題を解くためのソルバーが含まれています。このプロジェクトでは、制約計画ソルバーである「CP-SATソルバー」を利用しています。

## 問題設定

このスクリプトは、以下の多様な制約を考慮して、総コストが最小になるように従業員を各プロジェクトに割り当てます。

*   **コスト:** 各従業員を各プロジェクトに割り当てる際のコスト。
*   **スキル:** 各プロジェクトが必要とするスキルと、各従業員が持つスキルのレベル。
*   **予算:** 各プロジェクトに割り当てられた予算。
*   **希望度:** 各従業員のプロジェクトに対する希望度（5段階評価）。
*   **勤務時間:** 各従業員の標準勤務時間。
*   **残業:** 特定の従業員は残業が可能で、勤務時間の上限が緩和されます。

## コード解説

### `or-tools.py`

このスクリプトが最適化計算の本体です。

#### 1. データ定義: `get_assignment_data()`

この関数内で、最適化に使用するすべてのデータを定義します。

*   `workers`: 社員のリスト
*   `tasks`: プロジェクトのリスト
*   `costs`: 各社員とプロジェクトの組み合わせにおけるコスト
*   `required_skills`: 各プロジェクトが必要とするスキル
*   `worker_skills`: 各社員が持つスキル
*   `project_budgets`: 各プロジェクトの予算
*   `worker_preferences`: 各社員のプロジェクトへの希望度
*   `worker_overtime`: 各社員の残業可否
*   `worker_hours`: 各社員の勤務可能時間

#### 2. 最適化モデル: `solve_personnel_assignment()`

この関数で、OR-Toolsを使って最適化問題をモデル化し、解決します。

*   **変数定義**:
    *   `x[(w, t)]`: 社員 `w` がタスク `t` に割り当てられるかを示すブール変数（0 or 1）。
    *   `overtime[w]`: 社員 `w` が残業可能かを示すブール変数。
    *   `hours[(w, t)]`: 社員 `w` がタスク `t` に割り当てる時間を示す整数変数。

*   **制約条件**:
    *   各タスクには最低1人の社員が割り当てられる。
    *   各社員は最大1つのタスクにしか割り当てられない。
    *   タスクが必要とするスキルレベルを、割り当てられた社員のスキル合計が満たす。
    *   各社員の総勤務時間は、定められた上限（残業の有無で変動）を超えない。
    *   プロジェクトの総コストは、予算を超えない。
    *   社員の希望度が0のタスクには割り当てない。

*   **目的関数**:
    *   割り当てられた全タスクの総コストを最小化します。

## カスタマイズ方法

独自のデータでこのソルバーを使用するには、`or-tools.py`内の`get_assignment_data()`関数を直接編集してください。ご自身の社員リスト、タスク、コスト、スキルセットなどを反映させることで、実際の状況に合わせた最適化が可能です。

## セットアップと実行

1.  Dockerイメージをビルドします。
    ```shell
    docker build -t ortools-demo .
    ```

2.  コンテナを実行して、最適化結果を確認します。
    ```shell
    docker run --rm ortools-demo
    ```

## 実行結果の例

```
--- 割り当て結果 ---
社員 Aさん が PJ-1 (重要度高) に割り当てられました。 (コスト: 100)
社員 Bさん が PJ-2 (納期近) に割り当てられました。 (コスト: 90)
社員 Cさん が PJ-3 (専門性要) に割り当てられました。 (コスト: 110)
```